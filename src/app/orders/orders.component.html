<div class="container py-4 mt-nav">
  <!-- Filters -->
  <div class="row g-3 mb-4 align-items-end">
    <div class="col-md-6">
      <label class="form-label fw-bold">ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
      <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="applyFilters()" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„..." />
    </div>
    <div class="col-md-6">
      <label class="form-label fw-bold">ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø©</label>
      <select class="form-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
        <option value="AwaitingWorkerAcceptance">ğŸ•’ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¹Ø§Ù…Ù„</option>
        <option value="ApprovedAndScheduled">âœ… ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</option>
        <option value="WaitOtpCodeCompleted">ğŸ” Ø§Ù†ØªØ¸Ø§Ø± Ø±Ù…Ø² Ø§Ù„ØªØ£ÙƒÙŠØ¯</option>
        <option value="Completed">ğŸ‰ ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</option>
        <option value="Cancelled">âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</option>
      </select>
    </div>
  </div>

  <!-- Orders -->
  <div *ngFor="let order of filteredOrders" class="card mb-4 shadow-lg rounded-4"
       [ngClass]="{
         'border-start border-4 border-warning': order.status === 'AwaitingWorkerAcceptance',
         'border-start border-4 border-info': order.status === 'ApprovedAndScheduled',
         'border-start border-4 border-success': order.status === 'Completed',
         'border-start border-4 border-dark': order.status === 'WaitOtpCodeCompleted',
         'border-start border-4 border-danger': order.status === 'Cancelled'
       }">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold text-primary mb-0">ğŸ“¦ Ø·Ù„Ø¨ Ø±Ù‚Ù…: {{ order.id }}</h4>
        <span class="badge fs-6 px-3 py-2"
          [ngClass]="{
            'bg-warning text-dark': order.status === 'AwaitingWorkerAcceptance',
            'bg-info text-dark': order.status === 'ApprovedAndScheduled',
            'bg-success': order.status === 'Completed',
            'bg-secondary': order.status === 'WaitOtpCodeCompleted',
            'bg-danger': order.status === 'Cancelled'
          }">{{ order.status }}</span>
      </div>

<<<<<<< HEAD
      <ul class="list-unstyled mb-4 fs-6">
        <li>
          <strong>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> {{ order.customerName }}
          <span *ngIf="ratingSummaries[order.customerId]">
            - â­ {{ ratingSummaries[order.customerId]['averageRating'] | number: '1.1-1' }}
          </span>
        </li>
        <li>
          <strong>ğŸ§° Ø§Ù„ÙÙ†ÙŠ:</strong> {{ order.workerName }}
          <span *ngIf="ratingSummaries[order.workerId]">
            - â­ {{ ratingSummaries[order.workerId]['averageRating'] | number: '1.1-1' }}
          </span>
        </li>
        <li><strong>ğŸ’° Ø§Ù„Ø³Ø¹Ø±:</strong> {{ order.totalAmount }} Ø¬.Ù…</li>
        <li><strong>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> {{ order.scheduledDate | date:'medium' }}</li>
      </ul>

      <!-- Review Form -->
      <!-- â­ Review Display OR Form -->
<div *ngIf="order.status === 'Completed'">
  <!-- âœ… Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚ÙŠÙ‘Ù… Ø¨Ø§Ù„ÙØ¹Ù„ -->
  <div *ngIf="hasUserReviewed(order)">
    <p class="mb-1"><strong>âœ… ØªÙ‚ÙŠÙŠÙ…Ùƒ:</strong></p>
    <p>â­ {{ getMyReview(order)?.rating }} / 5</p>
    <p><em>{{ getMyReview(order)?.comment }}</em></p>
      <!-- <button class="btn btn-sm btn-outline-danger" (click)="deleteReview(order)">
      ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    </button> -->
  </div>

  <!-- ğŸ“ Ø¹Ø±Ø¶ ÙÙˆØ±Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù„Ùˆ Ù„Ø³Ù‡ Ù…Ø§ Ù‚ÙŠÙ‘Ù…Ø´ -->
  <div *ngIf="!hasUserReviewed(order)">
    <label class="form-label">âœ¨ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙÙ†ÙŠ:</label>
    <div class="d-flex align-items-center gap-2">
      <ng-container *ngFor="let star of [1,2,3,4,5]">
       <i class="fa-star fa fs-4"
 [ngClass]="{
  'fas text-warning': hoveredStar >= star || ratingForm[order.id].rating >= star,
  'far text-muted': hoveredStar < star && ratingForm[order.id].rating < star
}"

   (mouseenter)="hoveredStar = star"
   (mouseleave)="hoveredStar = 0"
   (click)="setRating(order.id, star)">
</i>

      </ng-container>
    </div>
    <textarea class="form-control mt-2" rows="2" [(ngModel)]="ratingForm[order.id].comment" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ù‹Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
    <button class="btn btn-sm btn-primary mt-2 fw-bold" (click)="submitReview(order)">âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
  </div>
</div>


      <!-- Actions -->
       <div class="row g-3">
        <div class="col-md-4" *ngIf="!isWorker && order.status === 'AwaitingWorkerAcceptance'">
          <input class="form-control" type="number" [(ngModel)]="newTotalAmount" placeholder="Ø³Ø¹Ø± Ø¬Ø¯ÙŠØ¯" />
          <button class="btn btn-outline-warning w-100 mt-1 fw-bold" (click)="updateTotalAmount(order.id)">ğŸ’µ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±</button>
        </div>

        <div class="col-md-4" *ngIf="!isWorker && order.status === 'AwaitingWorkerAcceptance'">
          <input class="form-control" type="date" [(ngModel)]="newScheduledDate" />
          <button class="btn btn-outline-info w-100 mt-1 fw-bold" (click)="updateDate(order.id)">ğŸ“† ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®</button>
        </div>

        <div class="col-md-4" *ngIf="!isWorker && order.status !== 'Completed'">
          <input class="form-control" type="text" [(ngModel)]="cancelReason" placeholder="Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡" />
          <button class="btn btn-outline-danger w-100 mt-1 fw-bold" (click)="cancelOrder(order.id)">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>

        <div class="col-md-4" *ngIf="isWorker && order.status === 'WaitOtpCodeCompleted'">
          <input class="form-control" type="text" [(ngModel)]="workerOtpCode" placeholder="OTP Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„" />
          <button class="btn btn-dark w-100 mt-1 fw-bold" (click)="workerCompleteOrder(order.id)">ğŸ§‘â€ğŸ”§ Ø¥ØªÙ…Ø§Ù… Ø§Ù„ÙÙ†ÙŠ</button>
        </div>

        <div class="col-md-4" *ngIf="!isWorker && order.status === 'ApprovedAndScheduled'">
          <button class="btn btn-success w-100 fw-bold" (click)="completeOrder(order.id)">ğŸ¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
        </div>

        <div class="col-md-4" *ngIf="isWorker && order.status === 'AwaitingWorkerAcceptance'">
          <button class="btn btn-primary w-100 fw-bold" (click)="acceptOrder(order.id)">ğŸ¤ Ù‚Ø¨ÙˆÙ„ Ø§Ù„ÙÙ†ÙŠ</button>
        </div>

        <div class="col-md-4" *ngIf="order.status !== 'Completed'">
          <button class="btn btn-outline-secondary w-100 fw-bold" (click)="goToChat(order)">ğŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
=======
          <div class="d-flex justify-content-between align-items-end">
            <div>
              <p class="mb-1">ğŸ‘¤ {{ order.customerName }}</p>
              <p class="mb-1">ğŸ§° {{ order.workerName }}</p>
              <p class="mb-1">ğŸ“… {{ order.createdAt | date: 'short' }}</p>
              <p class="mb-0">ğŸ’° {{ order.totalAmount }} Ø¬.Ù…</p>
            </div>
            <div>
              <button (click)="goToChat(order)" class="pr-sec-btn">chat</button>
            </div>
          </div>
>>>>>>> 4932474bb4a331c8830cc9ba3a4cb1caff239fc7
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <nav *ngIf="totalPages > 1" class="d-flex justify-content-center mt-4">
    <ul class="pagination">
      <li class="page-item" [class.disabled]="pageIndex === 1">
        <button class="page-link" (click)="goToPage(pageIndex - 1)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      </li>
      <li class="page-item disabled">
        <span class="page-link">ØµÙØ­Ø© {{ pageIndex }} Ù…Ù† {{ totalPages }}</span>
      </li>
      <li class="page-item" [class.disabled]="pageIndex === totalPages">
        <button class="page-link" (click)="goToPage(pageIndex + 1)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </li>
    </ul>
  </nav>
</div>
